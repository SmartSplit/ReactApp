@model ReactApp.ViewModels.Dashboard.DashboardViewModel

@{
    Layout = "_LTELayout";
    ViewBag.Title = "Dashboard";
}
      <!-- Small boxes (Stat box) -->
<div class="row">
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-aqua">
            <div class="inner">
                <h3>#</h3>

                <p>Payments</p>
            </div>
            <div class="icon">
                <i class="ion ion-bag"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-green">
            <div class="inner">
                <h3>@(Model.SessionsCount)</h3>

                <p>Sessions</p>
            </div>
            <div class="icon">
                <i class="ion ion-stats-bars"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-yellow">
            <div class="inner">
                <h3>@(Model.UsersCount)</h3>

                <p>User Registrations</p>
            </div>
            <div class="icon">
                <i class="ion ion-person-add"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-3 col-xs-6">
        <!-- small box -->
        <div class="small-box bg-red">
            <div class="inner">
                <h3>#</h3>

                <p>Products</p>
            </div>
            <div class="icon">
                <i class="ion ion-pie-graph"></i>
            </div>
            <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
        </div>
    </div>
    <!-- ./col -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-md-6">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Sessions activities in last 30 days</h3>

                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" id="refresh_morris_sessions">
                        <i class="fa fa-refresh" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            <div class="box-body chart-responsive">
                <div class="chart" id="revenue-chart" style="height: 300px;"></div>
            </div>
            <div class="overlay" id="overlay_morris_sessions" style="display: none">
                <i class="fa fa-refresh fa-spin"></i>
            </div>
            <!-- /.box-body -->
        </div>
    </div>
    <div class="col-md-6">
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">Users registrations in last 30 days</h3>

                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" id="refresh_morris_users">
                        <i class="fa fa-refresh" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            <div class="box-body chart-responsive">
                <div class="chart" id="line-chart" style="height: 300px;"></div>
            </div>
            <div class="overlay" id="overlay_morris_users" style="display: none">
                <i class="fa fa-refresh fa-spin"></i>
            </div>
            <!-- /.box-body -->
        </div>
    </div>
</div>
@section Scripts {
    <script>

        $(function () {
            loadMorrisSessions();
            loadMorrisUsers();
        });

        $('body').on('click', '#refresh_morris_sessions', function () {
            loadMorrisSessions();
        });

        $('body').on('click', '#refresh_morris_users', function () {
            loadMorrisUsers();
        });

        function loadMorrisSessions()
        {
            $.ajax({
                url: '@Url.Action("LoadMorrisSessions", "Dashboard")',
                beforeSend: () => { $("#overlay_morris_sessions").show(); }
            }).done((data) => {
                morrisSession(data);
            }).always(() => {
                $("#overlay_morris_sessions").hide();
            }).fail((error) => {
                console.log(error);
            });
        }

        function loadMorrisUsers()
        {
            $.ajax({
                url: '@Url.Action("LoadMorrisUsers", "Users")',
                beforeSend: () => { $("#overlay_morris_users").show(); }
            }).done((data) => {
                console.log(data);
                morrisUsers(data);
            }).always(() => {
                $("#overlay_morris_users").hide();
            }).fail((error) => {
                console.log(error);
            });
        }

        function morrisSession(data)
        {
            var area = new Morris.Area({
                element: 'revenue-chart',
                data: data,
                xkey: 'xKey',
                ykeys: ['startedCount', 'endedCount'],
                labels: ['Sessions started', 'Session ended'],
                hideHover: 'auto',
                lineColors: ['#a0d0e0', '#3c8dbc'],
            });
        }

        function morrisUsers(data)
        {
            var line = new Morris.Line({
                element: 'line-chart',
                resize: true,
                data: data,
                xkey: 'xKey',
                ykeys: ['yKey'],
                labels: ['Registered'],
                lineColors: ['#3c8dbc'],
                hideHover: 'auto'
            });
        }
    </script>
}